<head>
    <!-- for optimal display on high DPI devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/virtual-tour-plugin/index.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin/index.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gallery-plugin/index.min.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>

<script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gallery-plugin/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/virtual-tour-plugin/index.min.js"></script>

<!-- Plugins -->
<script src="https://cdn.jsdelivr.net/npm/photo-sphere-viewer-lensflare-plugin/dist/index.min.js"></script>

<!-- the viewer container must have a defined size -->
<div id="viewer" style="width: 100vw; height: 100vh;"></div>

<script type="module">
    const viewer = new PhotoSphereViewer.Viewer({
        container: document.querySelector('#viewer'),
        caption: 'Up Urban Climbing <b>&copy; 2023</b>',
        touchmoveTwoFingers: true,
        mousewheelCtrlKey: true,
        defaultYaw: '130deg',
        navbar: 'zoom move gallery caption fullscreen',
        plugins: [
            PhotoSphereViewer.MarkersPlugin,
            [PhotoSphereViewer.GalleryPlugin, {
                thumbnailSize: { width: 100, height: 100 },
            }],
            [PhotoSphereViewer.VirtualTourPlugin, {
                positionMode: 'gps',
                renderMode: '3d',
            }],
            [PhotoSphereViewerLensflarePlugin, {}]
        ]
    });

    const virtualTour = viewer.getPlugin(PhotoSphereViewer.VirtualTourPlugin);
    const lensflare = viewer.getPlugin(PhotoSphereViewerLensflarePlugin);

    virtualTour.addEventListener('node-changed', ({ node, data }) => {
        console.log(`Current node is ${node.id}`);
        switch (node.id) {
            case '1':
                lensflare.setLensflares([
                    {
                        id: 'sun',
                        position: { yaw: '145deg', pitch: '2deg' },
                        type: 0,
                    }
                ]);
                break;
            case '2':
                lensflare.setLensflares([
                    {
                        id: 'sun',
                        position: { yaw: '145deg', pitch: '2deg' },
                        type: 0,
                    },
                    {
                        id: 'moon',
                        position: { yaw: '30.6deg', pitch: '41.2deg' },
                        color: { h: 0.6, s: 0.5, l: 0.2 },
                    }
                ]);
                break;
            case '3':
                lensflare.setLensflares([]);
                break;
            case '4':
                lensflare.setLensflares([]);
                break;
            case '5':
                lensflare.setLensflares([]);
                break;
            case '6':
                lensflare.setLensflares([]);
                break;
            default:
                lensflare.setLensflares([]);
                break;
        }
    });

    virtualTour.setNodes([
        {
            id: '1',
            panorama: 'torre_est.JPG',
            thumbnail: 'torre_est.JPG',
            name: 'Torre (est)',
            links: [
                { nodeId: '2' }
            ],
            gps: [44.50396161405211, 11.404367415507782],
            panoData: { poseHeading: 100 },
        },
        {
            id: '2',
            panorama: 'torre_ovest.JPG',
            thumbnail: 'torre_ovest.JPG',
            name: 'Torre Ovest',
            links: [
                { nodeId: '6' },
                { nodeId: '4' },
                { nodeId: '1' }
            ],
            gps: [44.50409864245173, 11.404218029872105],
            panoData: { poseHeading: 170 },
        },
        {
            id: '3',
            panorama: 'interno_1.JPG',
            thumbnail: 'interno_1.JPG',
            name: 'Palestra Interna (1)',
            links: [
                { nodeId: '4' }, 
                { nodeId: '5' }
            ],
            gps: [44.503875718274784, 11.404077473221383],
            panoData: { poseHeading: 328 },
        },
        {
            id: '4',
            panorama: 'interno_2.JPG',
            thumbnail: 'interno_2.JPG',
            name: 'Palestra Interna (2)',
            links: [
                { nodeId: '3' }, 
                { nodeId: '5' }, 
                { nodeId: '2' }
            ],
            gps: [44.50393116931159, 11.404115299016564],
            panoData: { poseHeading: 78 },
        },
        {
            id: '5',
            panorama: 'interno_3.JPG',
            thumbnail: 'interno_3.JPG',
            name: 'Palestra Interna (3)',
            links: [
                { nodeId: '6' }, 
                { nodeId: '4' }
            ],
            gps: [44.503963443732424, 11.403965357751147],
            panoData: { poseHeading: 190 },
        },
        {
            id: '6',
            panorama: 'area_training.JPG',
            thumbnail: 'area_training.JPG',
            name: 'Area Training',
            links: [
                { nodeId: '5' }, 
                { nodeId: '2' }
            ],
            gps: [44.5040143176, 11.403956445523963],
            panoData: { poseHeading: 328 },
        },
    ], '2');
</script>